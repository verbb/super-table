void 0===Craft.SuperTable&&(Craft.SuperTable={}),function($){Craft.SuperTable.Input=Garnish.Base.extend({id:null,blockType:null,inputNamePrefix:null,totalNewBlocks:0,sorter:null,$div:null,$divInner:null,$table:null,$tbody:null,$addRowBtn:null,init:function(t,e,i,n){e=e[0],"table"==n.fieldLayout?new Craft.SuperTable.InputTable(t,e,i,n):"matrix"==n.fieldLayout?new Craft.SuperTable.InputMatrix(t,e,i,n):new Craft.SuperTable.InputRow(t,e,i,n)}}),Craft.SuperTable.InputTable=Garnish.Base.extend({id:null,blockType:null,inputNamePrefix:null,totalNewBlocks:0,sorter:null,$div:null,$divInner:null,$table:null,$tbody:null,$addRowBtn:null,init:function(t,e,i,n){this.id=t,this.blockType=e,this.inputNamePrefix=i,this.setSettings(n,{rowIdPrefix:"",onAddRow:$.noop,onDeleteRow:$.proxy(this,"deleteRow")}),this.$table=$("table#"+t),this.$tbody=this.$table.children("tbody"),this.sorter=new Craft.DataTableSorter(this.$table,{handle:"td.super-table-action .move",helperClass:"editablesupertablesorthelper",copyDraggeeInputValuesToHelper:!0}),this.$addRowBtn=this.$table.next(".add"),this.addListener(this.$addRowBtn,"activate","addRow");for(var s=this.$tbody.children(),a=0;a<s.length;a++){new Craft.EditableTable.Row(this,s[a]);var l=$(s[a]),t=l.data("id"),d="string"==typeof t&&t.match(/new(\d+)/);d&&d[1]>this.totalNewBlocks&&(this.totalNewBlocks=parseInt(d[1]))}this.updateAddBlockBtn()},addRow:function(){var t=this.blockType.type;this.totalNewBlocks++;var e="new"+this.totalNewBlocks,i=this.getParsedBlockHtml(this.blockType.bodyHtml,e),n=this.getParsedBlockHtml(this.blockType.footHtml,e),s='<tr data-id="'+e+'"><input type="hidden" name="'+this.inputNamePrefix+"["+e+'][type]" value="'+t+'" />'+i+'<td class="thin action super-table-action"><a class="move icon" title="'+Craft.t("super-table","Reorder")+'"></a></td><td class="thin action super-table-action"><a class="delete icon" title="'+Craft.t("super-table","Delete")+'"></a></td></tr>',a=$(s).appendTo(this.$tbody);Garnish.$bod.append(n),Craft.initUiElements(a),new Craft.EditableTable.Row(this,a),this.sorter.addItems(a),this.updateAddBlockBtn()},getParsedBlockHtml:function(t,e){return"string"==typeof t?t.replace(/__BLOCK_ST__/g,e):""},canAddMoreRows:function(){return!this.settings.maxRows||this.$tbody.children().length<this.settings.maxRows},updateAddBlockBtn:function(){this.canAddMoreRows()?this.$addRowBtn.removeClass("disabled"):this.$addRowBtn.addClass("disabled")},canDeleteRows:function(){return!this.settings.minRows||this.$tbody.children().length>this.settings.minRows},deleteRow:function(t){this.canDeleteRows()&&(this.sorter.removeItems(t.$tr),t.$tr.remove(),this.updateAddBlockBtn())}}),Craft.SuperTable.InputRow=Garnish.Base.extend({id:null,blockType:null,inputNamePrefix:null,settings:null,totalNewBlocks:0,sorter:null,$div:null,$divInner:null,$rows:null,$table:null,$tbody:null,$addRowBtn:null,init:function(t,e,i,n){this.id=t,this.blockType=e,this.inputNamePrefix=i,this.settings=n,this.$div=$("div#"+t),this.$divInner=this.$div.children(".rowLayoutContainer"),this.$rows=this.$divInner.children(".superTableRow"),this.sorter=new Garnish.DragSort(this.$rows,{handle:"tfoot .reorder .move",axis:"y",collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.9});for(var s=0;s<this.$rows.length;s++){new Craft.SuperTable.InputRow.Row(this,this.$rows[s]);var a=$(this.$rows[s]),t=a.data("id"),l="string"==typeof t&&t.match(/new(\d+)/);l&&l[1]>this.totalNewBlocks&&(this.totalNewBlocks=parseInt(l[1]))}this.$addRowBtn=this.$divInner.next(".add"),this.addListener(this.$addRowBtn,"activate","addRow"),this.updateAddBlockBtn(),this.addListener(this.$div,"resize","onResize"),Garnish.$doc.ready($.proxy(this,"onResize"))},addRow:function(){var t=this.blockType.type;this.totalNewBlocks++;var e="new"+this.totalNewBlocks,i=this.getParsedBlockHtml(this.blockType.bodyHtml,e),n=this.getParsedBlockHtml(this.blockType.footHtml,e),s='<div class="superTableRow" data-id="'+e+'"><input type="hidden" name="'+this.inputNamePrefix+"["+e+'][type]" value="'+t+'"><table id="'+e+'" class="superTable-table superTable-layout-row"><tbody>'+i+'</tbody><tfoot><tr><td class="floating reorder"><a class="move icon" title="'+Craft.t("super-table","Reorder")+'"></a></td><td class="floating delete"><a class="delete icon" title="'+Craft.t("super-table","Delete")+'"></a></td></tr></tfoot></table></div>',a=$(s).appendTo(this.$divInner);Garnish.$bod.append(n),Craft.initUiElements(a);var l=new Craft.SuperTable.InputRow.Row(this,a);this.sorter.addItems(a),l.expand(),this.updateAddBlockBtn()},getParsedBlockHtml:function(t,e){return"string"==typeof t?t.replace(/__BLOCK_ST__/g,e):""},canAddMoreRows:function(){return!this.settings.maxRows||this.$divInner.children(".superTableRow").length<this.settings.maxRows},onResize:function(){var t=this.$divInner.find("tfoot tr").width(),e=this.$divInner.find("td.rowHeader").width(),i=this.$divInner.width()-t-e-20,n=this.$divInner.find(".matrix.matrix-field");n.length&&$.each(n,function(t,e){var n=$(e);n.find(".buttons").outerWidth(!0)>i&&n.trigger("showNewBlockBtn")})},updateAddBlockBtn:function(){this.canAddMoreRows()?this.$addRowBtn.removeClass("disabled"):this.$addRowBtn.addClass("disabled")}}),Craft.SuperTable.InputRow.Row=Garnish.Base.extend({table:null,$tr:null,$deleteBtn:null,init:function(t,e){this.table=t,this.$tr=$(e);var i=this.$tr.children().last().find("tfoot .delete");this.addListener(i,"click","deleteRow")},canDeleteRows:function(){return!this.table.settings.minRows||this.table.$divInner.children(".superTableRow").length>this.table.settings.minRows},deleteRow:function(){this.canDeleteRows()&&(this.table.sorter.removeItems(this.$tr),this.contract(function(){this.$tr.remove(),this.table.updateAddBlockBtn()}))},expand:function(t){this.$tr.css(this._getContractedStyles()).velocity(this._getExpandedStyles(),"fast",t?$.proxy(t,this):null)},contract:function(t){this.$tr.css(this._getExpandedStyles()).velocity(this._getContractedStyles(),"fast",t?$.proxy(t,this):null)},_getExpandedStyles:function(){return{opacity:1,marginBottom:10}},_getContractedStyles:function(){return{opacity:0,marginBottom:-this.$tr.outerHeight()}}}),Craft.SuperTable.InputMatrix=Garnish.Base.extend({id:null,blockType:null,inputNamePrefix:null,settings:null,totalNewBlocks:0,sorter:null,$div:null,$divInner:null,$rows:null,$table:null,$tbody:null,$addRowBtn:null,init:function(t,e,i,n){this.id=t,this.blockType=e,this.inputNamePrefix=i,this.settings=n,this.$div=$("div#"+t),this.$divInner=this.$div.children(".matrixLayoutContainer"),this.$rows=this.$divInner.children(".superTableMatrix"),collapsedRows=Craft.SuperTable.InputMatrix.getCollapsedBlockIds(),this.sorter=new Garnish.DragSort(this.$rows,{handle:".actions .move",axis:"y",collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.9});for(var s=0;s<this.$rows.length;s++){var a=new Craft.SuperTable.InputMatrix.Row(this,this.$rows[s]),l=$(this.$rows[s]),t=l.data("id"),d="string"==typeof t&&t.match(/new(\d+)/);d&&d[1]>this.totalNewBlocks&&(this.totalNewBlocks=parseInt(d[1])),t&&-1!==$.inArray(""+t,collapsedRows)&&a.collapse()}this.$addRowBtn=this.$divInner.next(".add"),this.addListener(this.$addRowBtn,"activate","addRow"),this.updateAddBlockBtn(),this.addListener(this.$div,"resize","onResize"),Garnish.$doc.ready($.proxy(this,"onResize"))},addRow:function(){var t=this.blockType.type;this.totalNewBlocks++;var e="new"+this.totalNewBlocks,i=this.getParsedBlockHtml(this.blockType.bodyHtml,e),n=this.getParsedBlockHtml(this.blockType.footHtml,e),s='<div class="superTableMatrix matrixblock" data-id="{{ blockId }}"{% if block.collapsed %} data-collapsed{% endif %}><input type="hidden" name="'+this.inputNamePrefix+"["+e+'][type]" value="'+t+'"><div class="titlebar"><div class="blocktype"></div><div class="preview"></div></div><div class="actions"><a class="settings icon menubtn" title="'+Craft.t("app","Actions")+'" role="button"></a><div class="menu"><ul class="padded"><li><a data-icon="collapse" data-action="collapse">'+Craft.t("app","Colapse")+'</a></li><li class="hidden"><a data-icon="expand" data-action="expand">'+Craft.t("app","Expand")+'</a></li></ul><hr class="padded"><ul class="padded"><li><a class="error" data-icon="remove" data-action="delete">'+Craft.t("super-table","Delete")+'</a></li></ul></div><a class="move icon" title="'+Craft.t("super-table","Reorder")+'" role="button"></a></div><div class="fields">'+i+"</div></div>",a=$(s).appendTo(this.$divInner);Garnish.$bod.append(n),Craft.initUiElements(a);var l=new Craft.SuperTable.InputMatrix.Row(this,a);this.sorter.addItems(a),l.expand(),this.updateAddBlockBtn()},getParsedBlockHtml:function(t,e){return"string"==typeof t?t.replace(/__BLOCK_ST__/g,e):""},canAddMoreRows:function(){return!this.settings.maxRows||this.$divInner.children(".superTableMatrix").length<this.settings.maxRows},onResize:function(){var t=this.$divInner.width()-20,e=this.$divInner.find(".matrix.matrix-field");e.length&&$.each(e,function(e,i){var n=$(i);n.find(".buttons").outerWidth(!0)>t&&n.trigger("showNewBlockBtn")})},updateAddBlockBtn:function(){this.canAddMoreRows()?this.$addRowBtn.removeClass("disabled"):this.$addRowBtn.addClass("disabled")}},{collapsedBlockStorageKey:"Craft-"+Craft.systemUid+".SuperTable.InputMatrix.collapsedBlocks",getCollapsedBlockIds:function(){return"string"==typeof localStorage[Craft.SuperTable.InputMatrix.collapsedBlockStorageKey]?Craft.filterArray(localStorage[Craft.SuperTable.InputMatrix.collapsedBlockStorageKey].split(",")):[]},setCollapsedBlockIds:function(t){localStorage[Craft.SuperTable.InputMatrix.collapsedBlockStorageKey]=t.join(",")},rememberCollapsedBlockId:function(t){if("undefined"!=typeof Storage){var e=Craft.SuperTable.InputMatrix.getCollapsedBlockIds();-1===$.inArray(""+t,e)&&(e.push(t),Craft.SuperTable.InputMatrix.setCollapsedBlockIds(e))}},forgetCollapsedBlockId:function(t){if("undefined"!=typeof Storage){var e=Craft.SuperTable.InputMatrix.getCollapsedBlockIds(),i=$.inArray(""+t,e);-1!==i&&(e.splice(i,1),Craft.SuperTable.InputMatrix.setCollapsedBlockIds(e))}}}),Craft.SuperTable.InputMatrix.Row=Garnish.Base.extend({table:null,$tr:null,$deleteBtn:null,$titlebar:null,$actionMenu:null,id:null,collapsed:!1,$previewContainer:null,$fieldsContainer:null,init:function(t,e){this.table=t,this.$tr=$(e),this.id=this.$tr.data("id"),this.$titlebar=this.$tr.children(".titlebar"),this.$previewContainer=this.$titlebar.children(".preview"),this.$fieldsContainer=this.$tr.children(".fields");var i=this.$tr.find("> .actions > .settings"),n=new Garnish.MenuBtn(i);this.$actionMenu=n.menu.$container,n.menu.settings.onOptionSelect=$.proxy(this,"onMenuOptionSelect"),Garnish.hasAttr(this.$tr,"data-collapsed")&&this.collapse(),this._handleTitleBarClick=function(t){t.preventDefault(),this.toggle()},this.addListener(this.$titlebar,"doubletap",this._handleTitleBarClick)},deleteRow:function(){this.table.sorter.removeItems(this.$tr),this.$tr.velocity({opacity:0,marginBottom:-this.$tr.outerHeight()},"fast",$.proxy(function(){this.$tr.remove(),this.table.updateAddBlockBtn()},this))},toggle:function(){this.collapsed?this.expand():this.collapse(!0)},collapse:function(t){if(!this.collapsed){this.$tr.addClass("collapsed");for(var e="",i=this.$fieldsContainer.children(),n=0;n<i.length;n++){for(var s=$(i[n]),a=s.children(".input").find('select,input[type!="hidden"],textarea,.label'),l="",d=0;d<a.length;d++){var o=$(a[d]),r;if(o.hasClass("label")){var h=o.parent().parent();if(h.hasClass("lightswitch")&&(h.hasClass("on")&&o.hasClass("off")||!h.hasClass("on")&&o.hasClass("on")))continue;r=o.text()}else r=Craft.getText(Garnish.getInputPostVal(o));r instanceof Array&&(r=r.join(", ")),r&&(r=Craft.trim(r))&&(l&&(l+=", "),l+=r)}l&&(e+=(e?" <span>|</span> ":"")+l)}this.$previewContainer.html(e),this.$fieldsContainer.velocity("stop"),this.$tr.velocity("stop"),t?(this.$fieldsContainer.velocity("fadeOut",{duration:"fast"}),this.$tr.velocity({height:16},"fast")):(this.$previewContainer.show(),this.$fieldsContainer.hide(),this.$tr.css({height:16})),setTimeout($.proxy(function(){this.$actionMenu.find("a[data-action=collapse]:first").parent().addClass("hidden"),this.$actionMenu.find("a[data-action=expand]:first").parent().removeClass("hidden")},this),200),this.isNew?this.$collapsedInput?this.$collapsedInput.val("1"):this.$collapsedInput=$('<input type="hidden" name="'+this.matrix.inputNamePrefix+"["+this.id+'][collapsed]" value="1"/>').appendTo(this.$container):Craft.SuperTable.InputMatrix.rememberCollapsedBlockId(this.id),this.collapsed=!0}},expand:function(){if(this.collapsed){this.$tr.removeClass("collapsed"),this.$fieldsContainer.velocity("stop"),this.$tr.velocity("stop");var t=this.$tr.height();this.$tr.height("auto"),this.$fieldsContainer.show();var e=this.$tr.height();if(this.$tr.height(t),this.$fieldsContainer.hide().velocity("fadeIn",{duration:"fast"}),this.$tr.velocity({height:e},"fast",$.proxy(function(){this.$previewContainer.html(""),this.$tr.height("auto")},this)),setTimeout($.proxy(function(){this.$actionMenu.find("a[data-action=collapse]:first").parent().removeClass("hidden"),this.$actionMenu.find("a[data-action=expand]:first").parent().addClass("hidden")},this),200),!this.isNew&&"undefined"!=typeof Storage){var i=Craft.SuperTable.InputMatrix.getCollapsedBlockIds(),n=$.inArray(""+this.id,i);-1!==n&&(i.splice(n,1),Craft.SuperTable.InputMatrix.setCollapsedBlockIds(i))}this.isNew?this.$collapsedInput&&this.$collapsedInput.val(""):Craft.SuperTable.InputMatrix.forgetCollapsedBlockId(this.id),this.collapsed=!1}},onMenuOptionSelect:function(t){switch($(t).data("action")){case"collapse":this.collapse(!0);break;case"expand":this.expand();break;case"delete":this.deleteRow();break}}})}(jQuery),void 0===Craft.SuperTable&&(Craft.SuperTable={}),function($){Craft.SuperTable.Configurator=Garnish.Base.extend({fieldTypeInfo:null,inputNamePrefix:null,inputIdPrefix:null,blockTypeId:null,blockTypeNamePrefix:null,blockTypeIdPrefix:null,$container:null,$fieldsColumnContainer:null,$fieldSettingsColumnContainer:null,$fieldItemsContainer:null,$fieldSettingItemsContainer:null,$newFieldBtn:null,fields:null,selectedField:null,fieldSort:null,totalNewFields:0,fieldSettings:null,init:function(t,e,i){this.fieldTypeInfo=e,this.id=t,this.inputNamePrefix=i+"[blockTypes]["+this.id+"]",this.inputIdPrefix=Craft.formatInputId(this.inputNamePrefix),this.$container=$("#"+Craft.formatInputId(i)+"-supertable-configurator:first .input:first"),this.$fieldsColumnContainer=this.$container.children(".fields").children(),this.$fieldSettingsColumnContainer=this.$container.children(".stc-settings").children(),this.$fieldItemsOuterContainer=this.$fieldsColumnContainer.children(".field-items"),this.$fieldSettingItemsContainer=this.$fieldSettingsColumnContainer.children(".field-items"),this.$newFieldBtn=this.$fieldItemsOuterContainer.children(".btn"),this.$fieldItemsContainer=this.$fieldItemsOuterContainer.children('[data-id="'+this.id+'"]:first'),this.$fieldItemsContainer.length||(this.$fieldItemsContainer=$('<div data-id="'+this.id+'"/>').insertBefore(this.$newFieldBtn)),this.$fieldSettingsContainer=this.$fieldSettingItemsContainer.children('[data-id="'+this.id+'"]:first'),this.$fieldSettingsContainer.length||(this.$fieldSettingsContainer=$('<div data-id="'+this.id+'"/>').appendTo(this.$fieldSettingItemsContainer)),this.fields={};for(var n=this.$fieldItemsContainer.children(),s=0;s<n.length;s++){var a=$(n[s]),t=a.data("id");this.fields[t]=new Craft.SuperTable.Field(this,this,a),0==s&&(this.selectedField=this.fields[t]);var l="string"==typeof t&&t.match(/new(\d+)/);l&&l[1]>this.totalNewFields&&(this.totalNewFields=parseInt(l[1]))}this.addListener(this.$newFieldBtn,"click","addField"),this.fieldSort=new Garnish.DragSort(n,{handle:".move",axis:"y",onSortChange:$.proxy(function(){for(var t=0;t<this.fieldSort.$items.length;t++){var e=$(this.fieldSort.$items[t]),i=e.data("id");this.fields[i].$fieldSettingsContainer.appendTo(this.$fieldSettingsContainer)}},this)})},getFieldTypeInfo:function(t){for(var e=0;e<this.fieldTypeInfo.length;e++)if(this.fieldTypeInfo[e].type===t)return this.fieldTypeInfo[e]},addField:function(){this.totalNewFields++;var t="new"+this.totalNewFields,e=$('<div class="supertableconfigitem stci-field" data-id="'+t+'"><div class="name"><em class="light">'+Craft.t("super-table","(blank)")+'</em>&nbsp;</div><div class="handle code">&nbsp;</div><div class="actions"><a class="move icon" title="'+Craft.t("super-table","Reorder")+'"></a></div></div>').appendTo(this.$fieldItemsContainer);this.fields[t]=new Craft.SuperTable.Field(this,this,e),this.fields[t].select(),this.fieldSort.addItems(e)}}),Craft.SuperTable.Field=Garnish.Base.extend({configurator:null,blockType:null,id:null,inputNamePrefix:null,inputIdPrefix:null,selectedFieldType:null,initializedFieldTypeSettings:null,$item:null,$nameLabel:null,$handleLabel:null,$fieldSettingsContainer:null,$nameInput:null,$handleInput:null,$requiredCheckbox:null,$typeSelect:null,$typeSettingsContainer:null,$deleteBtn:null,init:function(t,e,i){this.configurator=t,this.blockType=e,this.$item=i,this.id=this.$item.data("id"),this.inputNamePrefix=this.blockType.inputNamePrefix+"[fields]["+this.id+"]",this.inputIdPrefix=this.blockType.inputIdPrefix+"-fields-"+this.id,this.initializedFieldTypeSettings={},this.$nameLabel=this.$item.children(".name"),this.$handleLabel=this.$item.children(".handle"),this.$fieldSettingsContainer=this.blockType.$fieldSettingsContainer.children('[data-id="'+this.id+'"]:first');var n=!this.$fieldSettingsContainer.length;n&&(this.$fieldSettingsContainer=this.getDefaultFieldSettings().appendTo(this.blockType.$fieldSettingsContainer)),this.$nameInput=$("#"+this.inputIdPrefix+"-name"),this.$handleInput=$("#"+this.inputIdPrefix+"-handle"),this.$requiredCheckbox=$("#"+this.inputIdPrefix+"-required"),this.$typeSelect=$("#"+this.inputIdPrefix+"-type"),this.$translationSettingsContainer=$("#"+this.inputIdPrefix+"-translation-settings"),this.$typeSettingsContainer=this.$fieldSettingsContainer.children(".fieldtype-settings:first"),this.$deleteBtn=this.$fieldSettingsContainer.children("a.delete:first"),n?this.setFieldType("craft\\fields\\PlainText"):(this.selectedFieldType=this.$typeSelect.val(),this.initializedFieldTypeSettings[this.selectedFieldType]=this.$typeSettingsContainer.children()),this.$handleInput.val()||new Craft.HandleGenerator(this.$nameInput,this.$handleInput),this.addListener(this.$item,"click","select"),this.addListener(this.$nameInput,"textchange","updateNameLabel"),this.addListener(this.$handleInput,"textchange","updateHandleLabel"),this.addListener(this.$requiredCheckbox,"change","updateRequiredIcon"),this.addListener(this.$typeSelect,"change","onTypeSelectChange"),this.addListener(this.$deleteBtn,"click","confirmDelete")},select:function(){this.blockType.selectedField!==this&&(this.blockType.selectedField&&this.blockType.selectedField.deselect(),this.configurator.$fieldSettingsColumnContainer.removeClass("hidden").trigger("resize"),this.blockType.$fieldSettingsContainer.removeClass("hidden"),this.$fieldSettingsContainer.removeClass("hidden"),this.$item.addClass("sel"),this.blockType.selectedField=this,Garnish.isMobileBrowser()||setTimeout($.proxy(function(){this.$nameInput.focus()},this),100))},deselect:function(){this.$item.removeClass("sel"),this.configurator.$fieldSettingsColumnContainer.addClass("hidden").trigger("resize"),this.blockType.$fieldSettingsContainer.addClass("hidden"),this.$fieldSettingsContainer.addClass("hidden"),this.blockType.selectedField=null},updateNameLabel:function(){var t=this.$nameInput.val();this.$nameLabel.html((t?Craft.escapeHtml(t):'<em class="light">'+Craft.t("super-table","(blank)")+"</em>")+"&nbsp;")},updateHandleLabel:function(){this.$handleLabel.html(Craft.escapeHtml(this.$handleInput.val())+"&nbsp;")},updateRequiredIcon:function(){this.$requiredCheckbox.prop("checked")?this.$nameLabel.addClass("required"):this.$nameLabel.removeClass("required")},onTypeSelectChange:function(){this.setFieldType(this.$typeSelect.val())},setFieldType:function(t){Craft.updateTranslationMethodSettings(t,this.$translationSettingsContainer),this.selectedFieldType&&this.initializedFieldTypeSettings[this.selectedFieldType].detach(),this.selectedFieldType=t,this.$typeSelect.val(t);var e=void 0===this.initializedFieldTypeSettings[t],i,n;if(e){var s=this.configurator.getFieldTypeInfo(t),a=this.getParsedFieldTypeHtml(s.settingsBodyHtml);n=this.getParsedFieldTypeHtml(s.settingsFootHtml),i=$("<div>"+a+"</div>"),this.initializedFieldTypeSettings[t]=i}else i=this.initializedFieldTypeSettings[t];i.appendTo(this.$typeSettingsContainer),e&&(Craft.initUiElements(i),Garnish.$bod.append(n)),this.$typeSettingsContainer.trigger("resize")},getParsedFieldTypeHtml:function(t){return"string"==typeof t?(t=t.replace(/__BLOCK_TYPE_ST__/g,this.blockType.id),t=t.replace(/__FIELD_ST__/g,this.id)):t="",t},getDefaultFieldSettings:function(){var t=$("<div/>",{"data-id":this.id});Craft.ui.createTextField({label:Craft.t("super-table","Name"),id:this.inputIdPrefix+"-name",name:this.inputNamePrefix+"[name]"}).appendTo(t),Craft.ui.createTextField({label:Craft.t("super-table","Handle"),id:this.inputIdPrefix+"-handle",class:"code",name:this.inputNamePrefix+"[handle]",maxlength:64,required:!0}).appendTo(t),Craft.ui.createTextareaField({label:Craft.t("super-table","Instructions"),id:this.inputIdPrefix+"-instructions",class:"nicetext",name:this.inputNamePrefix+"[instructions]"}).appendTo(t),Craft.ui.createCheckboxField({label:Craft.t("super-table","This field is required"),id:this.inputIdPrefix+"-required",name:this.inputNamePrefix+"[required]"}).appendTo(t);for(var e=[],i=0;i<this.configurator.fieldTypeInfo.length;i++)e.push({value:this.configurator.fieldTypeInfo[i].type,label:this.configurator.fieldTypeInfo[i].name});if(Craft.ui.createSelectField({label:Craft.t("super-table","Field Type"),id:this.inputIdPrefix+"-type",name:this.inputNamePrefix+"[type]",options:e,value:"craft\\fields\\PlainText"}).appendTo(t),Craft.isMultiSite){var n=$("<div/>",{id:this.inputIdPrefix+"-translation-settings"}).appendTo(t);Craft.ui.createSelectField({label:Craft.t("super-table","Translation Method"),id:this.inputIdPrefix+"-translation-method",name:this.inputNamePrefix+"[translationMethod]",options:[],value:"none",toggle:!0,targetPrefix:this.inputIdPrefix+"-translation-method-"}).appendTo(n);var s=$("<div/>",{id:this.inputIdPrefix+"-translation-method-custom",class:"hidden"}).appendTo(n);Craft.ui.createTextField({label:Craft.t("super-table","Translation Key Format"),id:this.inputIdPrefix+"-translation-key-format",name:this.inputNamePrefix+"[translationKeyFormat]"}).appendTo(s)}return $("<hr/>").appendTo(t),$("<div/>",{class:"fieldtype-settings"}).appendTo(t),$("<hr/>").appendTo(t),$("<a/>",{class:"error delete",text:Craft.t("super-table","Delete")}).appendTo(t),t},confirmDelete:function(){confirm(Craft.t("super-table","Are you sure you want to delete this field?"))&&this.selfDestruct()},selfDestruct:function(){this.deselect(),this.$item.remove(),this.$fieldSettingsContainer.remove(),this.blockType.fields[this.id]=null,delete this.blockType.fields[this.id]}})}(jQuery),void 0===Craft.SuperTable&&(Craft.SuperTable={}),function($){Craft.SuperTable.MatrixInputAlt=Garnish.Base.extend({id:null,blockTypes:null,blockTypesByHandle:null,inputNamePrefix:null,inputIdPrefix:null,maxBlocks:null,showingAddBlockMenu:!1,addBlockBtnGroupWidth:null,addBlockBtnContainerWidth:null,$container:null,$blockContainer:null,$addBlockBtnContainer:null,$addBlockBtnGroup:null,$addBlockBtnGroupBtns:null,blockSort:null,blockSelect:null,totalNewBlocks:0,init:function(e,i,n,s){this.id=e,this.blockTypes=i,this.inputNamePrefix=n,this.inputIdPrefix=Craft.formatInputId(this.inputNamePrefix),this.maxBlocks=s,this.$container=$("#"+this.id),this.$blockContainer=this.$container.children(".blocks"),this.$addBlockBtnContainer=this.$container.children(".buttons"),this.$addBlockBtnGroup=this.$addBlockBtnContainer.children(".btngroup"),this.$addBlockBtnGroupBtns=this.$addBlockBtnGroup.children(".btn"),this.$addBlockMenuBtn=this.$addBlockBtnContainer.children(".menubtn"),this.$container.data("matrix",this),this.setNewBlockBtn(),this.blockTypesByHandle={};var a;for(a=0;a<this.blockTypes.length;a++){var l=this.blockTypes[a];this.blockTypesByHandle[l.handle]=l}var d=this.$blockContainer.children(),o=Craft.SuperTable.MatrixInputAlt.getCollapsedBlockIds();for(this.blockSort=new Garnish.DragSort(d,{handle:"> .actions > .move",axis:"y",filter:$.proxy(function(){return this.blockSort.$targetItem.hasClass("sel")?this.blockSelect.getSelectedItems():this.blockSort.$targetItem},this),collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.9,onSortChange:$.proxy(function(){this.blockSelect.resetItemOrder()},this)}),this.blockSelect=new Garnish.Select(this.$blockContainer,d,{multi:!0,vertical:!0,handle:"> .checkbox, > .titlebar",checkboxMode:!0}),a=0;a<d.length;a++){var r=$(d[a]),h=r.data("id"),c="string"==typeof h&&h.match(/new(\d+)/);c&&c[1]>this.totalNewBlocks&&(this.totalNewBlocks=parseInt(c[1]));var p=new t(this,r);p.id&&-1!==$.inArray(""+p.id,o)&&p.collapse()}this.addListener(this.$addBlockBtnGroupBtns,"click",function(t){var e=$(t.target).data("type");this.addBlock(e)}),new Garnish.MenuBtn(this.$addBlockMenuBtn,{onOptionSelect:$.proxy(function(t){var e=$(t).data("type");this.addBlock(e)},this)}),this.updateAddBlockBtn(),this.addListener(this.$container,"resize","setNewBlockBtn"),Garnish.$doc.ready($.proxy(this,"setNewBlockBtn")),this.addListener(this.$container,"showNewBlockBtn","showNewBlockBtn")},showNewBlockBtn:function(){this.$addBlockBtnGroup.addClass("hidden"),this.$addBlockMenuBtn.removeClass("hidden"),this.showingAddBlockMenu=!0},setNewBlockBtn:function(){(this.addBlockBtnGroupWidth||(this.addBlockBtnGroupWidth=this.$addBlockBtnGroup.width(),this.addBlockBtnGroupWidth))&&this.addBlockBtnContainerWidth!==(this.addBlockBtnContainerWidth=this.$addBlockBtnContainer.width())&&(this.addBlockBtnGroupWidth>this.addBlockBtnContainerWidth?this.showingAddBlockMenu||(this.$addBlockBtnGroup.addClass("hidden"),this.$addBlockMenuBtn.removeClass("hidden"),this.showingAddBlockMenu=!0):this.showingAddBlockMenu&&(this.$addBlockMenuBtn.addClass("hidden"),this.$addBlockBtnGroup.removeClass("hidden"),this.showingAddBlockMenu=!1,-1!==navigator.userAgent.indexOf("Safari")&&Garnish.requestAnimationFrame($.proxy(function(){this.$addBlockBtnGroup.css("opacity",.99),Garnish.requestAnimationFrame($.proxy(function(){this.$addBlockBtnGroup.css("opacity","")},this))},this))))},canAddMoreBlocks:function(){return!this.maxBlocks||this.$blockContainer.children().length<this.maxBlocks},updateAddBlockBtn:function(){var t,e;if(this.canAddMoreBlocks())for(this.$addBlockBtnGroup.removeClass("disabled"),this.$addBlockMenuBtn.removeClass("disabled"),t=0;t<this.blockSelect.$items.length;t++)(e=this.blockSelect.$items.eq(t).data("block"))&&e.$actionMenu.find("a[data-action=add]").parent().removeClass("disabled");else for(this.$addBlockBtnGroup.addClass("disabled"),this.$addBlockMenuBtn.addClass("disabled"),t=0;t<this.blockSelect.$items.length;t++)(e=this.blockSelect.$items.eq(t).data("block"))&&e.$actionMenu.find("a[data-action=add]").parent().addClass("disabled")},addBlock:function(e,i){if(this.canAddMoreBlocks()){this.totalNewBlocks++;for(var n="new"+this.totalNewBlocks,s='<div class="matrixblock" data-id="'+n+'" data-type="'+e+'"><input type="hidden" name="'+this.inputNamePrefix+"["+n+'][type]" value="'+e+'"/><input type="hidden" name="'+this.inputNamePrefix+"["+n+'][enabled]" value="1"/><div class="titlebar"><div class="blocktype">'+this.getBlockTypeByHandle(e).name+'</div><div class="preview"></div></div><div class="checkbox" title="'+Craft.t("app","Select")+'"></div><div class="actions"><div class="status off" title="'+Craft.t("app","Disabled")+'"></div><a class="settings icon menubtn" title="'+Craft.t("app","Actions")+'" role="button"></a> <div class="menu"><ul class="padded"><li><a data-icon="collapse" data-action="collapse">'+Craft.t("app","Collapse")+'</a></li><li class="hidden"><a data-icon="expand" data-action="expand">'+Craft.t("app","Expand")+'</a></li><li><a data-icon="disabled" data-action="disable">'+Craft.t("app","Disable")+'</a></li><li class="hidden"><a data-icon="enabled" data-action="enable">'+Craft.t("app","Enable")+'</a></li></ul><hr class="padded"/><ul class="padded"><li><a class="error" data-icon="remove" data-action="delete">'+Craft.t("app","Delete")+'</a></li></ul><hr class="padded"/><ul class="padded">',a=0;a<this.blockTypes.length;a++){var l=this.blockTypes[a];s+='<li><a data-icon="plus" data-action="add" data-type="'+l.handle+'">'+Craft.t("app","Add {type} above",{type:l.name})+"</a></li>"}s+='</ul></div><a class="move icon" title="'+Craft.t("app","Reorder")+'" role="button"></a> </div></div>';var d=$(s);i?d.insertBefore(i):d.appendTo(this.$blockContainer);var o=$('<div class="fields"/>').appendTo(d),r=this.getParsedBlockHtml(this.blockTypesByHandle[e].bodyHtml,n),h=this.getParsedBlockHtml(this.blockTypesByHandle[e].footHtml,n);$(r).appendTo(o),d.css(this.getHiddenBlockCss(d)).velocity({opacity:1,"margin-bottom":10},"fast",$.proxy(function(){d.css("margin-bottom",""),Garnish.$bod.append(h),Craft.initUiElements(o),new t(this,d),this.blockSort.addItems(d),this.blockSelect.addItems(d),this.updateAddBlockBtn(),Garnish.requestAnimationFrame(function(){Garnish.scrollContainerToElement(d)})},this))}},getBlockTypeByHandle:function(t){for(var e=0;e<this.blockTypes.length;e++)if(this.blockTypes[e].handle===t)return this.blockTypes[e]},collapseSelectedBlocks:function(){this.callOnSelectedBlocks("collapse")},expandSelectedBlocks:function(){this.callOnSelectedBlocks("expand")},disableSelectedBlocks:function(){this.callOnSelectedBlocks("disable")},enableSelectedBlocks:function(){this.callOnSelectedBlocks("enable")},deleteSelectedBlocks:function(){this.callOnSelectedBlocks("selfDestruct")},callOnSelectedBlocks:function(t){for(var e=0;e<this.blockSelect.$selectedItems.length;e++)this.blockSelect.$selectedItems.eq(e).data("block")[t]()},getHiddenBlockCss:function(t){return{opacity:0,marginBottom:-t.outerHeight()}},getParsedBlockHtml:function(t,e){return"string"==typeof t?t.replace(/__BLOCK2__/g,e):""}},{collapsedBlockStorageKey:"Craft-"+Craft.systemUid+".SuperTable.MatrixInputAlt.collapsedBlocks",getCollapsedBlockIds:function(){return"string"==typeof localStorage[Craft.SuperTable.MatrixInputAlt.collapsedBlockStorageKey]?Craft.filterArray(localStorage[Craft.SuperTable.MatrixInputAlt.collapsedBlockStorageKey].split(",")):[]},setCollapsedBlockIds:function(t){localStorage[Craft.SuperTable.MatrixInputAlt.collapsedBlockStorageKey]=t.join(",")},rememberCollapsedBlockId:function(t){if("undefined"!=typeof Storage){var e=Craft.SuperTable.MatrixInputAlt.getCollapsedBlockIds();-1===$.inArray(""+t,e)&&(e.push(t),Craft.SuperTable.MatrixInputAlt.setCollapsedBlockIds(e))}},forgetCollapsedBlockId:function(t){if("undefined"!=typeof Storage){var e=Craft.SuperTable.MatrixInputAlt.getCollapsedBlockIds(),i=$.inArray(""+t,e);-1!==i&&(e.splice(i,1),Craft.SuperTable.MatrixInputAlt.setCollapsedBlockIds(e))}}});var t=Garnish.Base.extend({matrix:null,$container:null,$titlebar:null,$fieldsContainer:null,$previewContainer:null,$actionMenu:null,$collapsedInput:null,isNew:null,id:null,collapsed:!1,init:function(t,e){this.matrix=t,this.$container=e,this.$titlebar=e.children(".titlebar"),this.$previewContainer=this.$titlebar.children(".preview"),this.$fieldsContainer=e.children(".fields"),this.$container.data("block",this),this.id=this.$container.data("id"),this.isNew=!this.id||"string"==typeof this.id&&"new"===this.id.substr(0,3);var i=this.$container.find("> .actions > .settings"),n=new Garnish.MenuBtn(i);this.$actionMenu=n.menu.$container,n.menu.settings.onOptionSelect=$.proxy(this,"onMenuOptionSelect"),Garnish.hasAttr(this.$container,"data-collapsed")&&this.collapse(),this._handleTitleBarClick=function(t){t.preventDefault(),
this.toggle()},this.addListener(this.$titlebar,"doubletap",this._handleTitleBarClick)},toggle:function(){this.collapsed?this.expand():this.collapse(!0)},collapse:function(t){if(!this.collapsed){this.$container.addClass("collapsed");for(var e="",i=this.$fieldsContainer.children(),n=0;n<i.length;n++){for(var s=$(i[n]),a=s.children(".input").find('select,input[type!="hidden"],textarea,.label'),l="",d=0;d<a.length;d++){var o=$(a[d]),r;if(o.hasClass("label")){var h=o.parent().parent();if(h.hasClass("lightswitch")&&(h.hasClass("on")&&o.hasClass("off")||!h.hasClass("on")&&o.hasClass("on")))continue;r=o.text()}else r=Craft.getText(Garnish.getInputPostVal(o));r instanceof Array&&(r=r.join(", ")),r&&(r=Craft.trim(r))&&(l&&(l+=", "),l+=r)}l&&(e+=(e?" <span>|</span> ":"")+l)}this.$previewContainer.html(e),this.$fieldsContainer.velocity("stop"),this.$container.velocity("stop"),t?(this.$fieldsContainer.velocity("fadeOut",{duration:"fast"}),this.$container.velocity({height:16},"fast")):(this.$previewContainer.show(),this.$fieldsContainer.hide(),this.$container.css({height:16})),setTimeout($.proxy(function(){this.$actionMenu.find("a[data-action=collapse]:first").parent().addClass("hidden"),this.$actionMenu.find("a[data-action=expand]:first").parent().removeClass("hidden")},this),200),this.isNew?this.$collapsedInput?this.$collapsedInput.val("1"):this.$collapsedInput=$('<input type="hidden" name="'+this.matrix.inputNamePrefix+"["+this.id+'][collapsed]" value="1"/>').appendTo(this.$container):Craft.SuperTable.MatrixInputAlt.rememberCollapsedBlockId(this.id),this.collapsed=!0}},expand:function(){if(this.collapsed){this.$container.removeClass("collapsed"),this.$fieldsContainer.velocity("stop"),this.$container.velocity("stop");var t=this.$container.height();this.$container.height("auto"),this.$fieldsContainer.show();var e=this.$container.height();if(this.$container.height(t),this.$fieldsContainer.hide().velocity("fadeIn",{duration:"fast"}),this.$container.velocity({height:e},"fast",$.proxy(function(){this.$previewContainer.html(""),this.$container.height("auto")},this)),setTimeout($.proxy(function(){this.$actionMenu.find("a[data-action=collapse]:first").parent().removeClass("hidden"),this.$actionMenu.find("a[data-action=expand]:first").parent().addClass("hidden")},this),200),!this.isNew&&"undefined"!=typeof Storage){var i=Craft.SuperTable.MatrixInputAlt.getCollapsedBlockIds(),n=$.inArray(""+this.id,i);-1!==n&&(i.splice(n,1),Craft.SuperTable.MatrixInputAlt.setCollapsedBlockIds(i))}this.isNew?this.$collapsedInput&&this.$collapsedInput.val(""):Craft.SuperTable.MatrixInputAlt.forgetCollapsedBlockId(this.id),this.collapsed=!1}},disable:function(){this.$container.children('input[name$="[enabled]"]:first').val(""),this.$container.addClass("disabled"),setTimeout($.proxy(function(){this.$actionMenu.find("a[data-action=disable]:first").parent().addClass("hidden"),this.$actionMenu.find("a[data-action=enable]:first").parent().removeClass("hidden")},this),200),this.collapse(!0)},enable:function(){this.$container.children('input[name$="[enabled]"]:first').val("1"),this.$container.removeClass("disabled"),setTimeout($.proxy(function(){this.$actionMenu.find("a[data-action=disable]:first").parent().removeClass("hidden"),this.$actionMenu.find("a[data-action=enable]:first").parent().addClass("hidden")},this),200)},onMenuOptionSelect:function(t){var e=this.matrix.blockSelect.totalSelected>1&&this.matrix.blockSelect.isSelected(this.$container),i=$(t);switch(i.data("action")){case"collapse":e?this.matrix.collapseSelectedBlocks():this.collapse(!0);break;case"expand":e?this.matrix.expandSelectedBlocks():this.expand();break;case"disable":e?this.matrix.disableSelectedBlocks():this.disable();break;case"enable":e?this.matrix.enableSelectedBlocks():(this.enable(),this.expand());break;case"add":var n=i.data("type");this.matrix.addBlock(n,this.$container);break;case"delete":e?confirm(Craft.t("app","Are you sure you want to delete the selected blocks?"))&&this.matrix.deleteSelectedBlocks():this.selfDestruct();break}},selfDestruct:function(){this.$container.velocity(this.matrix.getHiddenBlockCss(this.$container),"fast",$.proxy(function(){this.$container.remove(),this.matrix.updateAddBlockBtn()},this))}})}(jQuery),void 0===Craft.SuperTable&&(Craft.SuperTable={}),function($){Craft.SuperTable.MatrixConfiguratorAlt=Garnish.Base.extend({fieldTypeInfo:null,inputNamePrefix:null,inputIdPrefix:null,$container:null,$blockTypesColumnContainer:null,$fieldsColumnContainer:null,$fieldSettingsColumnContainer:null,$blockTypeItemsOuterContainer:null,$blockTypeItemsContainer:null,$fieldItemsContainer:null,$fieldSettingItemsContainer:null,$newBlockTypeBtn:null,$newFieldBtn:null,blockTypes:null,selectedBlockType:null,blockTypeSort:null,totalNewBlockTypes:0,init:function(t,i){this.fieldTypeInfo=t,this.inputNamePrefix=i,this.inputIdPrefix=Craft.formatInputId(this.inputNamePrefix),this.$container=$("#"+this.inputIdPrefix+"-matrix-configurator:first .input:first"),this.$blockTypesColumnContainer=this.$container.children(".block-types").children(),this.$fieldsColumnContainer=this.$container.children(".fields").children(),this.$fieldSettingsColumnContainer=this.$container.children(".field-settings").children(),this.$blockTypeItemsOuterContainer=this.$blockTypesColumnContainer.children(".items"),this.$blockTypeItemsContainer=this.$blockTypeItemsOuterContainer.children(".blocktypes"),this.$fieldItemsOuterContainer=this.$fieldsColumnContainer.children(".items"),this.$fieldSettingItemsContainer=this.$fieldSettingsColumnContainer.children(".items"),this.setContainerHeight(),this.$newBlockTypeBtn=this.$blockTypeItemsOuterContainer.children(".btn"),this.$newFieldBtn=this.$fieldItemsOuterContainer.children(".btn"),this.blockTypes={};for(var n=this.$blockTypeItemsContainer.children(),s=0;s<n.length;s++){var a=$(n[s]),l=a.data("id");this.blockTypes[l]=new e(this,a);var d="string"==typeof l&&l.match(/new(\d+)/);d&&d[1]>this.totalNewBlockTypes&&(this.totalNewBlockTypes=parseInt(d[1]))}this.blockTypeSort=new Garnish.DragSort(n,{handle:".move",axis:"y"}),this.addListener(this.$newBlockTypeBtn,"click","addBlockType"),this.addListener(this.$newFieldBtn,"click","addFieldToSelectedBlockType"),this.addListener(this.$blockTypesColumnContainer,"resize","setContainerHeight"),this.addListener(this.$fieldsColumnContainer,"resize","setContainerHeight"),this.addListener(this.$fieldSettingsColumnContainer,"resize","setContainerHeight")},setContainerHeight:function(){setTimeout($.proxy(function(){var t=Math.max(this.$blockTypesColumnContainer.height(),this.$fieldsColumnContainer.height(),this.$fieldSettingsColumnContainer.height(),400);this.$container.height(t)},this),1)},getFieldTypeInfo:function(t){for(var e=0;e<this.fieldTypeInfo.length;e++)if(this.fieldTypeInfo[e].type===t)return this.fieldTypeInfo[e]},addBlockType:function(){this.getBlockTypeSettingsModal(),this.blockTypeSettingsModal.show(),this.blockTypeSettingsModal.onSubmit=$.proxy(function(t,i){this.totalNewBlockTypes++;var n="new"+this.totalNewBlockTypes,s=$('<div class="matrixconfigitem mci-blocktype" data-id="'+n+'"><div class="name"></div><div class="handle code"></div><div class="actions"><a class="move icon" title="'+Craft.t("app","Reorder")+'"></a><a class="settings icon" title="'+Craft.t("app","Settings")+'"></a></div><input class="hidden" name="'+this.inputNamePrefix+"[blockTypes]["+n+'][name]"><input class="hidden" name="'+this.inputNamePrefix+"[blockTypes]["+n+'][handle]"></div>').appendTo(this.$blockTypeItemsContainer);this.blockTypes[n]=new e(this,s),this.blockTypes[n].applySettings(t,i),this.blockTypes[n].select(),this.blockTypes[n].addField(),this.blockTypeSort.addItems(s)},this)},addFieldToSelectedBlockType:function(){this.selectedBlockType&&this.selectedBlockType.addField()},getBlockTypeSettingsModal:function(){return this.blockTypeSettingsModal||(this.blockTypeSettingsModal=new t),this.blockTypeSettingsModal}});var t=Garnish.Modal.extend({init:function(){this.base(),this.$form=$('<form class="modal fitted"/>').appendTo(Garnish.$bod),this.setContainer(this.$form),this.$body=$('<div class="body"/>').appendTo(this.$form),this.$nameField=$('<div class="field"/>').appendTo(this.$body),this.$nameHeading=$('<div class="heading"/>').appendTo(this.$nameField),this.$nameLabel=$('<label for="new-block-type-name">'+Craft.t("app","Name")+"</label>").appendTo(this.$nameHeading),this.$nameInstructions=$('<div class="instructions"><p>'+Craft.t("app","What this block type will be called in the CP.")+"</p></div>").appendTo(this.$nameHeading),this.$nameInputContainer=$('<div class="input"/>').appendTo(this.$nameField),this.$nameInput=$('<input type="text" class="text fullwidth" id="new-block-type-name"/>').appendTo(this.$nameInputContainer),this.$nameErrorList=$('<ul class="errors"/>').appendTo(this.$nameInputContainer).hide(),this.$handleField=$('<div class="field"/>').appendTo(this.$body),this.$handleHeading=$('<div class="heading"/>').appendTo(this.$handleField),this.$handleLabel=$('<label for="new-block-type-handle">'+Craft.t("app","Handle")+"</label>").appendTo(this.$handleHeading),this.$handleInstructions=$('<div class="instructions"><p>'+Craft.t("app","How youâ€™ll refer to this block type in the templates.")+"</p></div>").appendTo(this.$handleHeading),this.$handleInputContainer=$('<div class="input"/>').appendTo(this.$handleField),this.$handleInput=$('<input type="text" class="text fullwidth code" id="new-block-type-handle"/>').appendTo(this.$handleInputContainer),this.$handleErrorList=$('<ul class="errors"/>').appendTo(this.$handleInputContainer).hide(),this.$deleteBtn=$('<a class="error left hidden" style="line-height: 30px;">'+Craft.t("app","Delete")+"</a>").appendTo(this.$body),this.$buttons=$('<div class="buttons right" style="margin-top: 0;"/>').appendTo(this.$body),this.$cancelBtn=$('<div class="btn">'+Craft.t("app","Cancel")+"</div>").appendTo(this.$buttons),this.$submitBtn=$('<input type="submit" class="btn submit"/>').appendTo(this.$buttons),this.handleGenerator=new Craft.HandleGenerator(this.$nameInput,this.$handleInput),this.base(this.$form,{closeOtherModals:!1,autoShow:!1}),this.addListener(this.$cancelBtn,"click","hide"),this.addListener(this.$form,"submit","onFormSubmit"),this.addListener(this.$deleteBtn,"click","onDeleteClick")},onFormSubmit:function(t){if(t.preventDefault(),this.visible){this.handleGenerator.listening&&this.handleGenerator.updateTarget();var e=Craft.trim(this.$nameInput.val()),i=Craft.trim(this.$handleInput.val());e&&i?(this.hide(),this.onSubmit(e,i)):Garnish.shake(this.$form)}},onDeleteClick:function(){confirm(Craft.t("app","Are you sure you want to delete this block type?"))&&(this.hide(),this.onDelete())},show:function(t,e,i){this.$nameInput.val("string"==typeof t?t:""),this.$handleInput.val("string"==typeof e?e:""),e?this.handleGenerator.stopListening():this.handleGenerator.startListening(),void 0===t?(this.$deleteBtn.addClass("hidden"),this.$submitBtn.val(Craft.t("app","Create"))):(this.$deleteBtn.removeClass("hidden"),this.$submitBtn.val(Craft.t("app","Save"))),this.displayErrors("name",i?i.name:null),this.displayErrors("handle",i?i.handle:null),Garnish.isMobileBrowser()||setTimeout($.proxy(function(){this.$nameInput.trigger("focus")},this),100),this.base()},displayErrors:function(t,e){var i=this["$"+t+"Input"],n=this["$"+t+"ErrorList"];if(n.children().remove(),e){i.addClass("error"),n.show();for(var s=0;s<e.length;s++)$("<li/>").text(e[s]).appendTo(n)}else i.removeClass("error"),n.hide()}}),e=Garnish.Base.extend({configurator:null,id:null,errors:null,inputNamePrefix:null,inputIdPrefix:null,$item:null,$nameLabel:null,$handleLabel:null,$nameHiddenInput:null,$handleHiddenInput:null,$settingsBtn:null,$fieldItemsContainer:null,$fieldSettingsContainer:null,fields:null,selectedField:null,fieldSort:null,totalNewFields:0,fieldSettings:null,init:function(t,e){this.configurator=t,this.$item=e,this.id=this.$item.data("id"),this.errors=this.$item.data("errors"),this.inputNamePrefix=this.configurator.inputNamePrefix+"[blockTypes]["+this.id+"]",this.inputIdPrefix=this.configurator.inputIdPrefix+"-blockTypes-"+this.id,this.$nameLabel=this.$item.children(".name"),this.$handleLabel=this.$item.children(".handle"),this.$nameHiddenInput=this.$item.find('input[name$="[name]"]:first'),this.$handleHiddenInput=this.$item.find('input[name$="[handle]"]:first'),this.$settingsBtn=this.$item.find(".settings"),this.$fieldItemsContainer=this.configurator.$fieldItemsOuterContainer.children('[data-id="'+this.id+'"]:first'),this.$fieldItemsContainer.length||(this.$fieldItemsContainer=$('<div data-id="'+this.id+'"/>').insertBefore(this.configurator.$newFieldBtn)),this.$fieldSettingsContainer=this.configurator.$fieldSettingItemsContainer.children('[data-id="'+this.id+'"]:first'),this.$fieldSettingsContainer.length||(this.$fieldSettingsContainer=$('<div data-id="'+this.id+'"/>').appendTo(this.configurator.$fieldSettingItemsContainer)),this.fields={};for(var n=this.$fieldItemsContainer.children(),s=0;s<n.length;s++){var a=$(n[s]),l=a.data("id");this.fields[l]=new i(this.configurator,this,a);var d="string"==typeof l&&l.match(/new(\d+)/);d&&d[1]>this.totalNewFields&&(this.totalNewFields=parseInt(d[1]))}this.addListener(this.$item,"click","select"),this.addListener(this.$settingsBtn,"click","showSettings"),this.fieldSort=new Garnish.DragSort(n,{handle:".move",axis:"y",onSortChange:$.proxy(function(){for(var t=0;t<this.fieldSort.$items.length;t++){var e=$(this.fieldSort.$items[t]),i=e.data("id");this.fields[i].$fieldSettingsContainer.appendTo(this.$fieldSettingsContainer)}},this)})},select:function(){this.configurator.selectedBlockType!==this&&(this.configurator.selectedBlockType&&this.configurator.selectedBlockType.deselect(),this.configurator.$fieldsColumnContainer.removeClass("hidden").trigger("resize"),this.$fieldItemsContainer.removeClass("hidden"),this.$item.addClass("sel"),this.configurator.selectedBlockType=this)},deselect:function(){this.$item.removeClass("sel"),this.configurator.$fieldsColumnContainer.addClass("hidden").trigger("resize"),this.$fieldItemsContainer.addClass("hidden"),this.$fieldSettingsContainer.addClass("hidden"),this.configurator.selectedBlockType=null,this.selectedField&&this.selectedField.deselect()},showSettings:function(){var t=this.configurator.getBlockTypeSettingsModal();t.show(this.$nameHiddenInput.val(),this.$handleHiddenInput.val(),this.errors),t.onSubmit=$.proxy(this,"applySettings"),t.onDelete=$.proxy(this,"selfDestruct")},applySettings:function(t,e){this.errors&&(this.errors=null,this.$settingsBtn.removeClass("error")),this.$nameLabel.text(t),this.$handleLabel.text(e),this.$nameHiddenInput.val(t),this.$handleHiddenInput.val(e)},addField:function(){this.totalNewFields++;var t="new"+this.totalNewFields,e=$('<div class="matrixconfigitem mci-field" data-id="'+t+'"><div class="name"><em class="light">'+Craft.t("app","(blank)")+'</em>&nbsp;</div><div class="handle code">&nbsp;</div><div class="actions"><a class="move icon" title="'+Craft.t("app","Reorder")+'"></a></div></div>').appendTo(this.$fieldItemsContainer);this.fields[t]=new i(this.configurator,this,e),this.fields[t].select(),this.fieldSort.addItems(e)},selfDestruct:function(){this.deselect(),this.$item.remove(),this.$fieldItemsContainer.remove(),this.$fieldSettingsContainer.remove(),this.configurator.blockTypes[this.id]=null,delete this.configurator.blockTypes[this.id]}}),i=Garnish.Base.extend({configurator:null,blockType:null,id:null,inputNamePrefix:null,inputIdPrefix:null,selectedFieldType:null,initializedFieldTypeSettings:null,$item:null,$nameLabel:null,$handleLabel:null,$fieldSettingsContainer:null,$nameInput:null,$handleInput:null,$requiredCheckbox:null,$typeSelect:null,$translationSettingsContainer:null,$typeSettingsContainer:null,$deleteBtn:null,init:function(t,e,i){this.configurator=t,this.blockType=e,this.$item=i,this.id=this.$item.data("id"),this.inputNamePrefix=this.blockType.inputNamePrefix+"[fields]["+this.id+"]",this.inputIdPrefix=this.blockType.inputIdPrefix+"-fields-"+this.id,this.initializedFieldTypeSettings={},this.$nameLabel=this.$item.children(".name"),this.$handleLabel=this.$item.children(".handle"),this.$fieldSettingsContainer=this.blockType.$fieldSettingsContainer.children('[data-id="'+this.id+'"]:first');var n=!this.$fieldSettingsContainer.length;n&&(this.$fieldSettingsContainer=this.getDefaultFieldSettings().appendTo(this.blockType.$fieldSettingsContainer)),this.$nameInput=$("#"+this.inputIdPrefix+"-name"),this.$handleInput=$("#"+this.inputIdPrefix+"-handle"),this.$requiredCheckbox=$("#"+this.inputIdPrefix+"-required"),this.$typeSelect=$("#"+this.inputIdPrefix+"-type"),this.$translationSettingsContainer=$("#"+this.inputIdPrefix+"-translation-settings"),this.$typeSettingsContainer=this.$fieldSettingsContainer.children(".fieldtype-settings:first"),this.$deleteBtn=this.$fieldSettingsContainer.children("a.delete:first"),n?this.setFieldType("craft\\fields\\PlainText"):(this.selectedFieldType=this.$typeSelect.val(),this.initializedFieldTypeSettings[this.selectedFieldType]=this.$typeSettingsContainer.children()),this.$handleInput.val()||new Craft.HandleGenerator(this.$nameInput,this.$handleInput),this.addListener(this.$item,"click","select"),this.addListener(this.$nameInput,"textchange","updateNameLabel"),this.addListener(this.$handleInput,"textchange","updateHandleLabel"),this.addListener(this.$requiredCheckbox,"change","updateRequiredIcon"),this.addListener(this.$typeSelect,"change","onTypeSelectChange"),this.addListener(this.$deleteBtn,"click","confirmDelete")},select:function(){this.blockType.selectedField!==this&&(this.blockType.selectedField&&this.blockType.selectedField.deselect(),this.configurator.$fieldSettingsColumnContainer.removeClass("hidden").trigger("resize"),this.blockType.$fieldSettingsContainer.removeClass("hidden"),this.$fieldSettingsContainer.removeClass("hidden"),this.$item.addClass("sel"),this.blockType.selectedField=this,Garnish.isMobileBrowser()||setTimeout($.proxy(function(){this.$nameInput.trigger("focus")},this),100))},deselect:function(){this.$item.removeClass("sel"),this.configurator.$fieldSettingsColumnContainer.addClass("hidden").trigger("resize"),this.blockType.$fieldSettingsContainer.addClass("hidden"),this.$fieldSettingsContainer.addClass("hidden"),this.blockType.selectedField=null},updateNameLabel:function(){var t=this.$nameInput.val();this.$nameLabel.html((t?Craft.escapeHtml(t):'<em class="light">'+Craft.t("app","(blank)")+"</em>")+"&nbsp;")},updateHandleLabel:function(){this.$handleLabel.html(Craft.escapeHtml(this.$handleInput.val())+"&nbsp;")},updateRequiredIcon:function(){this.$requiredCheckbox.prop("checked")?this.$nameLabel.addClass("required"):this.$nameLabel.removeClass("required")},onTypeSelectChange:function(){this.setFieldType(this.$typeSelect.val())},setFieldType:function(t){Craft.updateTranslationMethodSettings(t,this.$translationSettingsContainer),this.selectedFieldType&&this.initializedFieldTypeSettings[this.selectedFieldType].detach(),this.selectedFieldType=t,this.$typeSelect.val(t);var e=void 0===this.initializedFieldTypeSettings[t],i,n;if(e){var s=this.configurator.getFieldTypeInfo(t),a=this.getParsedFieldTypeHtml(s.settingsBodyHtml);n=this.getParsedFieldTypeHtml(s.settingsFootHtml),i=$("<div>"+a+"</div>"),this.initializedFieldTypeSettings[t]=i}else i=this.initializedFieldTypeSettings[t];i.appendTo(this.$typeSettingsContainer),e&&(Craft.initUiElements(i),Garnish.$bod.append(n)),this.$typeSettingsContainer.trigger("resize")},getParsedFieldTypeHtml:function(t){return"string"==typeof t?(t=t.replace(/__BLOCK_TYPE_NESTED__/g,this.blockType.id),t=t.replace(/__FIELD_NESTED__/g,this.id)):t="",t},getDefaultFieldSettings:function(){var t=$("<div/>",{"data-id":this.id});Craft.ui.createTextField({label:Craft.t("app","Name"),id:this.inputIdPrefix+"-name",name:this.inputNamePrefix+"[name]"}).appendTo(t),Craft.ui.createTextField({label:Craft.t("app","Handle"),id:this.inputIdPrefix+"-handle",class:"code",name:this.inputNamePrefix+"[handle]",maxlength:64,required:!0}).appendTo(t),Craft.ui.createTextareaField({label:Craft.t("app","Instructions"),id:this.inputIdPrefix+"-instructions",class:"nicetext",name:this.inputNamePrefix+"[instructions]"}).appendTo(t),Craft.ui.createCheckboxField({label:Craft.t("app","This field is required"),id:this.inputIdPrefix+"-required",name:this.inputNamePrefix+"[required]"}).appendTo(t);for(var e=[],i=0;i<this.configurator.fieldTypeInfo.length;i++)e.push({value:this.configurator.fieldTypeInfo[i].type,label:this.configurator.fieldTypeInfo[i].name});if(Craft.ui.createSelectField({label:Craft.t("app","Field Type"),id:this.inputIdPrefix+"-type",name:this.inputNamePrefix+"[type]",options:e,value:"craft\\fields\\PlainText"}).appendTo(t),Craft.isMultiSite){var n=$("<div/>",{id:this.inputIdPrefix+"-translation-settings"}).appendTo(t);Craft.ui.createSelectField({label:Craft.t("app","Translation Method"),id:this.inputIdPrefix+"-translation-method",name:this.inputNamePrefix+"[translationMethod]",options:[],value:"none",toggle:!0,targetPrefix:this.inputIdPrefix+"-translation-method-"}).appendTo(n);var s=$("<div/>",{id:this.inputIdPrefix+"-translation-method-custom",class:"hidden"}).appendTo(n);Craft.ui.createTextField({label:Craft.t("app","Translation Key Format"),id:this.inputIdPrefix+"-translation-key-format",name:this.inputNamePrefix+"[translationKeyFormat]"}).appendTo(s)}return $("<hr/>").appendTo(t),$("<div/>",{class:"fieldtype-settings"}).appendTo(t),$("<hr/>").appendTo(t),$("<a/>",{class:"error delete",text:Craft.t("app","Delete")}).appendTo(t),t},confirmDelete:function(){confirm(Craft.t("app","Are you sure you want to delete this field?"))&&this.selfDestruct()},selfDestruct:function(){this.deselect(),this.$item.remove(),this.$fieldSettingsContainer.remove(),this.blockType.fields[this.id]=null,delete this.blockType.fields[this.id]}})}(jQuery);
//# sourceMappingURL=./super-table.js.map